components:
  schemas:
    # Common Schemas
    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Error code
        message:
          type: string
          description: Error message (in Vietnamese for user-facing errors)
        details:
          type: object
          description: Additional error details

    # User Schemas
    User:
      type: object
      required:
        - id
        - email
        - created_at
      properties:
        id:
          type: integer
          format: int64
        email:
          type: string
          format: email
          nullable: true
        username:
          type: string
          nullable: true
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
          nullable: true

    UserProfile:
      type: object
      properties:
        user_id:
          type: integer
          format: int64
        display_name:
          type: string
          nullable: true
        avatar_url:
          type: string
          nullable: true
        birth_day:
          type: string
          format: date
          nullable: true
        bio:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
          nullable: true

    RegisterRequest:
      type: object
      required:
        - password
      properties:
        display_name:
          type: string
          maxLength: 100
        email:
          type: string
          format: email
        username:
          type: string
          minLength: 3
          maxLength: 100
        password:
          type: string
          minLength: 6

    RegisterResponse:
      type: object
      required:
        - user_id
        - token
      properties:
        user_id:
          type: integer
          format: int64
        token:
          type: string
        user:
          $ref: '#/components/schemas/User'

    LoginRequest:
      type: object
      required:
        - password
      properties:
        email:
          type: string
          format: email
        username:
          type: string
        password:
          type: string

    LoginResponse:
      type: object
      required:
        - user_id
        - token
      properties:
        user_id:
          type: integer
          format: int64
        token:
          type: string
        user:
          $ref: '#/components/schemas/User'

    UpdateProfileRequest:
      type: object
      properties:
        display_name:
          type: string
          maxLength: 100
        avatar_url:
          type: string
          format: uri
          maxLength: 500
        birth_day:
          type: string
          format: date
        bio:
          type: string

    AvailabilityResponse:
      type: object
      required:
        - available
        - exists
      properties:
        available:
          type: boolean
        exists:
          type: boolean

    # Reference Data Schemas
    Language:
      type: object
      required:
        - id
        - code
        - name
      properties:
        id:
          type: integer
          format: int32
        code:
          type: string
          example: en
        name:
          type: string
          example: English

    Topic:
      type: object
      required:
        - id
        - code
        - name
      properties:
        id:
          type: integer
          format: int64
        code:
          type: string
          example: education
        name:
          type: string
          example: Education

    Level:
      type: object
      required:
        - id
        - code
        - name
      properties:
        id:
          type: integer
          format: int64
        code:
          type: string
          example: HSK1
        name:
          type: string
          example: HSK Level 1
        description:
          type: string
          nullable: true
        languageId:
          type: integer
          format: int32
          nullable: true
        difficultyOrder:
          type: integer
          format: int32
          nullable: true

    # Dictionary Schemas
    Word:
      type: object
      required:
        - id
        - languageId
        - lemma
      properties:
        id:
          type: integer
          format: int64
        languageId:
          type: integer
          format: int32
        lemma:
          type: string
        lemmaNormalized:
          type: string
          nullable: true
        partOfSpeechId:
          type: integer
          format: int32
          nullable: true
        romanization:
          type: string
          nullable: true
        frequencyRank:
          type: integer
          nullable: true
        note:
          type: string
          nullable: true
        topics:
          type: array
          items:
            $ref: '#/components/schemas/Topic'
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Sense:
      type: object
      required:
        - id
        - wordId
        - senseOrder
        - definition
      properties:
        id:
          type: integer
          format: int64
        wordId:
          type: integer
          format: int64
        senseOrder:
          type: integer
          format: int32
        definition:
          type: string
        definitionLanguageId:
          type: integer
          format: int32
        levelId:
          type: integer
          format: int64
          nullable: true

    Translation:
      type: object
      required:
        - wordId
        - languageId
        - priority
      properties:
        wordId:
          type: integer
          format: int64
        wordLemma:
          type: string
        languageId:
          type: integer
          format: int32
        languageCode:
          type: string
        priority:
          type: integer
          format: int32

    Example:
      type: object
      required:
        - id
        - content
      properties:
        id:
          type: integer
          format: int64
        content:
          type: string
        languageId:
          type: integer
          format: int32
        audioUrl:
          type: string
          nullable: true
        source:
          type: string
          nullable: true
        translations:
          type: array
          items:
            type: object
            properties:
              languageId:
                type: integer
                format: int32
              content:
                type: string

    Pronunciation:
      type: object
      properties:
        id:
          type: integer
          format: int64
        wordId:
          type: integer
          format: int64
        dialect:
          type: string
          nullable: true
        ipa:
          type: string
          nullable: true
        phonetic:
          type: string
          nullable: true
        audioUrl:
          type: string
          nullable: true

    SenseDetail:
      type: object
      required:
        - id
        - senseOrder
        - definition
      properties:
        id:
          type: integer
          format: int64
        senseOrder:
          type: integer
          format: int32
        partOfSpeechId:
          type: integer
          format: int32
        partOfSpeechName:
          type: string
          nullable: true
        definition:
          type: string
        definitionLanguageId:
          type: integer
          format: int32
        levelId:
          type: integer
          format: int64
          nullable: true
        levelName:
          type: string
          nullable: true
        note:
          type: string
          nullable: true
        translations:
          type: array
          items:
            $ref: '#/components/schemas/Word'
        examples:
          type: array
          items:
            $ref: '#/components/schemas/Example'

    WordRelation:
      type: object
      required:
        - relationType
        - targetWord
      properties:
        relationType:
          type: string
          enum:
            - synonym
            - antonym
            - related
        note:
          type: string
          nullable: true
        targetWord:
          $ref: '#/components/schemas/Word'

    WordDetail:
      type: object
      required:
        - word
        - senses
        - pronunciations
      properties:
        word:
          $ref: '#/components/schemas/Word'
        senses:
          type: array
          items:
            $ref: '#/components/schemas/SenseDetail'
        pronunciations:
          type: array
          items:
            $ref: '#/components/schemas/Pronunciation'
        relations:
          type: array
          items:
            $ref: '#/components/schemas/WordRelation'
          nullable: true

    DictionarySearchResponse:
      type: object
      required:
        - words
        - total
        - limit
        - offset
      properties:
        words:
          type: array
          items:
            $ref: '#/components/schemas/Word'
        total:
          type: integer
          format: int64
        limit:
          type: integer
        offset:
          type: integer

    # Game Schemas
    CreateGameSessionRequest:
      type: object
      required:
        - mode
        - source_language_id
        - target_language_id
      properties:
        mode:
          type: string
          enum:
            - topic
            - level
        source_language_id:
          type: integer
          format: int32
          minimum: 1
        target_language_id:
          type: integer
          format: int32
          minimum: 1
        topic_id:
          type: integer
          format: int64
          nullable: true
          minimum: 1
          description: Required if mode is 'topic'
        level_id:
          type: integer
          format: int64
          nullable: true
          minimum: 1
          description: Required if mode is 'level'

    GameQuestionOption:
      type: object
      required:
        - id
        - optionLabel
        - targetWord
        - isCorrect
      properties:
        id:
          type: integer
          format: int64
        optionLabel:
          type: string
          enum:
            - A
            - B
            - C
            - D
        targetWord:
          $ref: '#/components/schemas/Word'
        isCorrect:
          type: boolean

    GameQuestion:
      type: object
      required:
        - id
        - questionOrder
        - sourceWord
        - correctTargetWord
        - options
      properties:
        id:
          type: integer
          format: int64
        questionOrder:
          type: integer
          format: int32
        questionType:
          type: string
          example: word_to_translation
        sourceWord:
          $ref: '#/components/schemas/Word'
        correctTargetWord:
          $ref: '#/components/schemas/Word'
        options:
          type: array
          minItems: 4
          maxItems: 4
          items:
            $ref: '#/components/schemas/GameQuestionOption'

    GameSession:
      type: object
      required:
        - id
        - userId
        - mode
        - sourceLanguageId
        - targetLanguageId
        - totalQuestions
        - correctQuestions
        - startedAt
      properties:
        id:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        mode:
          type: string
          enum:
            - topic
            - level
        sourceLanguageId:
          type: integer
          format: int32
        targetLanguageId:
          type: integer
          format: int32
        topicId:
          type: integer
          format: int64
          nullable: true
        levelId:
          type: integer
          format: int64
          nullable: true
        totalQuestions:
          type: integer
          format: int32
        correctQuestions:
          type: integer
          format: int32
        startedAt:
          type: string
          format: date-time
        endedAt:
          type: string
          format: date-time
          nullable: true

    GameSessionDetail:
      type: object
      required:
        - session
        - questions
      properties:
        session:
          $ref: '#/components/schemas/GameSession'
        questions:
          type: array
          items:
            $ref: '#/components/schemas/GameQuestion'

    SubmitAnswerRequest:
      type: object
      required:
        - question_id
        - selected_option_id
      properties:
        question_id:
          type: integer
          format: int64
          minimum: 1
        selected_option_id:
          type: integer
          format: int64
          minimum: 1
        response_time_ms:
          type: integer
          format: int32
          minimum: 1
          nullable: true

    GameAnswer:
      type: object
      required:
        - id
        - questionId
        - sessionId
        - userId
        - isCorrect
        - answeredAt
      properties:
        id:
          type: integer
          format: int64
        questionId:
          type: integer
          format: int64
        sessionId:
          type: integer
          format: int64
        userId:
          type: integer
          format: int64
        selectedOptionId:
          type: integer
          format: int64
          nullable: true
        isCorrect:
          type: boolean
        responseTimeMs:
          type: integer
          format: int32
          nullable: true
        answeredAt:
          type: string
          format: date-time

    # Statistics Schemas
    SessionStatistics:
      type: object
      required:
        - session_id
        - total_questions
        - correct_answers
        - wrong_answers
        - accuracy_percentage
        - duration_seconds
        - average_response_time_ms
      properties:
        session_id:
          type: integer
          format: int64
        total_questions:
          type: integer
        correct_answers:
          type: integer
        wrong_answers:
          type: integer
        accuracy_percentage:
          type: number
          format: float
          description: Accuracy percentage (0-100)
        duration_seconds:
          type: integer
          description: Total session duration in seconds
        average_response_time_ms:
          type: number
          format: float
          description: Average response time in milliseconds
